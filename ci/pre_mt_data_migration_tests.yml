Please set DATA_DIR_ARCHIVE_NAME:
  allow_failure: true
  tags:
    - test-large
  stage: "Frontend MT Data Migration Tests"
  image: "$SG_BUILD_IMAGE"
  needs:
    - job: build
    - job: deploy_snapshot
  artifacts:
    reports:
      dotenv: mt-data-migration-test.env    
  rules:
    - if: '$CI_PIPELINE_SOURCE == "parent_pipeline"'
      when: never 
    - when: manual      
  script:
    - |

      if [[ -z "${DATA_DIR_ARCHIVE_NAME:-}" ]]; then
        echo "[ ERROR ]: DATA_DIR_ARCHIVE_NAME variable is not set or is empty,example value mt-test-data-9.0.1.tar.gz"
        exit 1
      fi
      
      MT_DATA_URL="https://maven.search-guard.com/test-data/com/floragunn/mt-test-data/${DATA_DIR_ARCHIVE_NAME}"

      echo "Checking if MT test data archive exists: ${MT_DATA_URL}"
      if ! curl -u "$ARTIFACTORY_USER:$ARTIFACTORY_PASSWORD" -sfI "${MT_DATA_URL}" > /dev/null; then
        echo "[ ERROR ]: MT test data archive does not exist or is not accessible: ${MT_DATA_URL}"
        exit 1
      fi
      #workaround for https://gitlab.com/gitlab-org/gitlab/-/issues/288064
      echo "KIBANA_DATA_DIR_ARCHIVE_NAME=$DATA_DIR_ARCHIVE_NAME" >> mt-data-migration-test.env
      echo "CHECK_FRONTEND_PREREQUISITES=1" >> mt-data-migration-test.env
