<div class="searchguard app-container ng-scope" id="section-editor" ng-controller="sgEditRolesController">

    <sgc-edit-header></sgc-edit-header>

    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <div class="">

                    <p class="error-message" ng-show="errorMessage">{{ errorMessage }}</p>

                    <form name="objectForm" id="object-form" method="post" ng-submit="saveObject($event)" style="width:80%">

                        <sgc-form-resource-name></sgc-form-resource-name>

                        <!-- Add document type -->
                        <table class="tableIndexGroups fullwidth">
                            <tr>
                                <td>
                                    <h4>Index Name: {{indexname}}</h4>
                                </td>
                                <td class="actions">
                                    <button type="button" class="kuiButton kuiButton--primary kuiButton--iconText" ng-click="shownewresource = true">
                                        <span class="kuiButton__icon kuiIcon fa-plus"></span>
                                        Add Document Type
                                    </button>
                                </td>
                            </tr>
                        </table>

                        <!-- Add document type form -->
                        <table class="kuiTable tableIndexGroups" ng-show="shownewresource">
                            <thead>
                            <tr>
                                <th class="kuiTableHeaderCell tableHeaderCellIndexGroups">
                                    Document Type Name
                                </th>
                                <th class="kuiTableHeaderCell">
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                                <tr data-test-subj="userRow" class="kuiTableRow">
                                    <td class="kuiTableRowCell cellAlignTop">
                                        <fieldset class="marginbottom--small" id="object-form-actiongroups">
                                            <input type="text" class="kuiTextInput fullwidth" ng-model="newresourcename" name="">
                                        </fieldset>
                                    </td>
                                    <td class="kuiTableRowCell cellAlignTop actions">
                                        <button type="button" class="kuiButton kuiButton--primary kuiButton--text" ng-click="submitAddDocumentType()">Add</button>
                                        <button type="button" class="kuiButton kuiButton--secondary kuiButton--text" ng-click="shownewresource = false;newresourcename=''">Cancel</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <accordeon title="Permissions for document type: '{{doctypename}}'" is-collapsed="true" class="marginbottom--small" data-ng-repeat="doctypename in keys(resource.indices[indexname])">

                            <!-- Delete document type -->
                            <table class="tableIndexGroups fullwidth">
                                <tr>
                                    <td class="actions">
                                        <button type="button" ng-click="removeObjectKey(resource.indices[indexname], doctypename)" class="kuiButton kuiButton--danger kuiButton--iconText">
                                            <span class="kuiButton__icon kuiIcon fa-trash"></span>
                                            Delete Document Type '{{doctypename}}'
                                        </button>
                                    </td>
                                </tr>
                            </table>

                            <!-- Action Groups Table -->
                            <table class="kuiTable tableIndexGroups">
                                <thead>
                                <tr>
                                    <th class="kuiTableHeaderCell tableHeaderCellIndexGroups">
                                        Action Groups
                                    </th>

                                    <th class="kuiTableHeaderCell">
                                    </th>
                                </tr>
                                </thead>
                                <tbody >
                                    <tr data-test-subj="userRow" class="kuiTableRow" data-ng-repeat="actiongroup in resource.indices[indexname][doctypename].actiongroups track by $index" >
                                        <td class="kuiTableRowCell cellAlignTop">
                                            <fieldset class="marginbottom--small" id="object-form-actiongroups">
                                                <angucomplete id="indexactiongroup-{{indexname}}-{{doctypename}}"
                                                              placeholder="Add Action Group"
                                                              pause="10"
                                                              selectedobject="resource.indices[indexname][doctypename].actiongroups[$index]"
                                                              localdata="actiongroupsAutoComplete"
                                                              minlength="1"
                                                              datafield="name"
                                                              titlefield="name"
                                                              searchfields="name"
                                                              inputclass="kuiTextInput fullwidth"/>
                                            </fieldset>
                                        </td>
                                        <td class="kuiTableRowCell cellAlignTop actions">
                                            <button style="display:inline-block" type="button" ng-click="removeArrayEntry(resource.indices[indexname][doctypename].actiongroups, actiongroup)" class="kuiButton kuiButton--danger kuiButton--iconText">
                                                <span class="kuiButton__icon kuiIcon fa-trash-o"></span>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr class="kuiTableRow">
                                        <td class="kuiTableRowCell cellAlignTop actions"></td>
                                        <td class="kuiTableRowCell cellAlignTop actions">
                                            <button type="button" ng-click="addArrayEntry(resource.indices[indexname][doctypename], 'actiongroups', '')" ng-disabled="lastArrayEntryEmpty(resource.indices[indexname][doctypename].actiongroups)" class="kuiButton kuiButton--primary kuiButton--iconText">
                                                <span class="kuiButton__icon kuiIcon fa-plus"></span>
                                                Add Action Group
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <!-- Permissions Table -->
                            <table class="kuiTable tableIndexGroups">
                                <thead>
                                <tr>
                                    <th class="kuiTableHeaderCell tableHeaderCellIndexGroups">
                                        Permissions
                                    </th>

                                    <th class="kuiTableHeaderCell">
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                    <tr data-test-subj="userRow" class="kuiTableRow" data-ng-repeat="permission in resource.indices[indexname][doctypename].permissions track by $index">
                                        <td class="kuiTableRowCell cellAlignTop">
                                            <fieldset class="marginbottom--small" id="object-form-actiongroups">
                                                <input type="text" class="kuiTextInput fullwidth" pattern="^(cluster:.*|indices:.*)" title="Permissions need to start with cluster: or indices:" ng-model="resource.indices[indexname][doctypename].permissions[$index]" placeholder="Start with cluster: or index:">
                                            </fieldset>
                                        </td>
                                        <td class="kuiTableRowCell cellAlignTop actions">
                                            <a ng-click="removeArrayEntry(resource.indices[indexname][doctypename].permissions, permission)" class="kuiButton kuiButton--danger kuiButton--iconText">
                                                <span class="kuiButton__icon kuiIcon fa-trash-o"></span>
                                            </a>
                                        </td>
                                    </tr>
                                    <tr class="kuiTableRow">
                                        <td class="kuiTableRowCell cellAlignTop actions"></td>
                                        <td class="kuiTableRowCell cellAlignTop actions">
                                            <button type="button" ng-click="addArrayEntry(resource.indices[indexname][doctypename], 'permissions', '')" ng-disabled="lastArrayEntryEmpty(resource.indices[indexname][doctypename].permissions)" class="kuiButton kuiButton--primary kuiButton--iconText">
                                                <span class="kuiButton__icon kuiIcon fa-plus"></span>
                                                Add Permissions
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </accordeon>

                        <accordeon title="Document- and Field-Level-Security" is-collapsed="true" class="marginbottom--small">
                            <!-- DLS Table -->
                            <table class="kuiTable tableIndexGroups">
                                <thead>
                                <tr>

                                    <th class="kuiTableHeaderCell tableHeaderCellIndexGroups">
                                        Document Level Security
                                    </th>

                                    <th class="kuiTableHeaderCell">
                                    </th>

                                </tr>
                                </thead>
                                <tbody>
                                <tr class="kuiTableRow">
                                    <td class="kuiTableRowCell cellAlignTop">
                                        <fieldset class="marginbottom--small" id="object-form-actiongroups">
                                            <input type="text" class="kuiTextInput fullwidth" ng-model="resource.dlsfls[indexname]['_dls_']" name="">
                                        </fieldset>
                                    </td>
                                    <td class="kuiTableRowCell cellAlignTop actions">
                                        <a ng-click="resource.dlsfls[indexname]['_dls_']=''" class="kuiButton kuiButton--danger kuiButton--iconText">
                                            <span class="kuiButton__icon kuiIcon fa-trash-o"></span>
                                        </a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>

                            <!-- FLS Table -->
                            <table class="kuiTable tableIndexGroups">
                                <thead>
                                <tr>

                                    <th class="kuiTableHeaderCell tableHeaderCellIndexGroups">
                                        Field Level Security
                                    </th>

                                    <th class="kuiTableHeaderCell">
                                    </th>

                                </tr>
                                </thead>
                                <tbody>
                                <tr data-ng-repeat="actiongroup in resource.dlsfls[indexname]['_fls_'] track by $index">
                                    <td class="kuiTableRowCell cellAlignTop">
                                        <fieldset class="marginbottom--small" id="object-form-actiongroups" >
                                            <input type="text" class="kuiTextInput fullwidth" ng-model="resource.dlsfls[indexname]['_fls_'][$index]" name="">
                                        </fieldset>
                                    </td>
                                    <td class="kuiTableRowCell cellAlignTop actions">
                                        <a ng-click="removeArrayEntry(resource.dlsfls[indexname]['_fls_'], actiongroup)" class="kuiButton kuiButton--danger kuiButton--iconText">
                                            <span class="kuiButton__icon kuiIcon fa-trash-o"></span>
                                        </a>
                                    </td>
                                </tr>
                                <tr class="kuiTableRow">
                                    <td class="kuiTableRowCell cellAlignTop actions"></td>
                                    <td class="kuiTableRowCell cellAlignTop actions">
                                        <button type="button" ng-click="addArrayEntry(resource.dlsfls[indexname], '_fls_', '')" ng-disabled="lastArrayEntryEmpty(resource.dlsfls[indexname]['_fls_'])" class="kuiButton kuiButton--primary kuiButton--iconText">
                                            <span class="kuiButton__icon kuiIcon fa-plus"></span>
                                            Add Field
                                        </button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </accordeon>
                        <button class="kuiButton kuiButton--primary kuiButton--text" type="submit">Submit</button>
                        <button class="kuiButton kuiButton--secondary kuiButton--text" type="submit" ng-click="cancel()">Cancel</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
